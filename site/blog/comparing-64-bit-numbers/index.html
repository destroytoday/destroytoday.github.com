<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="generator" content="HTML Tidy for Mac OS X (vers 31 October 2006 - Apple Inc. build 15.6), see www.w3.org" />
    <title>
      Destroy Today / Comparing 64-bit numbers in AS3 and SQLite
    </title>
    <link type="application/rss+xml" rel="alternate" title="Destroy Today" href="http://feeds.feedburner.com/destroytoday" />
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript">
//<![CDATA[

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3256994-11']);
    _gaq.push(['_trackPageview']);

    (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

                var disqus_shortname = 'destroytodaystaging';
                var disqus_developer = 1;
                var disqus_container_id = 'disqus_thread';
                var disqus_domain = 'disqus.com';
    //]]>
    </script>
    <style type="text/css">
/*<![CDATA[*/
    div.c11 {background: #FFFFFF}
    div.c10 {width: 25.0%; background: #FFFFFF}
    div.c9 {width: 25.0%; background: #CCCCCC}
    div.c8 {width: 25.0%; background: #666666}
    div.c7 {width: 25.0%; background: #000000}
    div.c6 {width: 25.0%; background: #C8C8C8}
    div.c5 {width: 25.0%; background: #EDD628}
    div.c4 {width: 25.0%; background: #E86600}
    div.c3 {background: #000000}
    div.c2 {width: 50.0%; background: #000000}
    div.c1 {width: 50.0%; background: #5A919F}
    /*]]>*/
    </style>
  </head>
  <body>
    <div id="page">
      <div id="top">
        <div id="identity">
          <h1>
            <a href="/" class="destroy">destroy</a><a href="/" class="today">today</a>
          </h1>
        </div>
        <div id="navigation">
          <ul>
            <li>
              <a href="/about">About</a>
            </li>
            <li class="selected">
              <a href="/blog">Blog</a>
            </li>
            <li>
              <a href="/folio">Folio</a>
            </li>
            <li>
              <a href="/lab">Lab</a>
            </li>
            <li>
              <a href="/contact">Contact</a>
            </li>
          </ul>
        </div>
      </div>
      <div id="content">
        <div id="blog">
          <div id="primary" class="grid-3">
            <div class="post">
              <h2>
                <a href="/blog/comparing-64-bit-numbers">Comparing 64-bit numbers in AS3 and SQLite</a>
              </h2>
              <div class="metadata">
                <div class="date">
                  <a href="/blog/comparing-64-bit-numbers">01.30.11</a>
                </div>
                <div class="comment-count">
                  <a href="/blog/comparing-64-bit-numbers#disqus_thread" data-disqus-identifier="http://staging.destroytoday.com/blog/comparing-64-bit-numbers">0</a> <a href="/blog/comparing-64-bit-numbers"><img class="bubble-up" src="/assets/site/comment_up.png" width="10" height="10" /><img class="bubble-over" src="/assets/site/comment_over.png" width="10" height="10" /></a>
                </div>
              </div>
              <p>
                When <a href='http://engineering.twitter.com/2010/06/announcing-snowflake.html'>Twitter introduced Snowflake</a>, their new ID generator, they also introduced 64-bit IDs. At first, I didn&#8217;t think much of this. When the <a href='http://www.google.com/search?q=twitpocalypse&amp;#038;ie=utf-8&amp;#038;oe=utf-8&amp;#038;aq=t&amp;#038;rls=org.mozilla:en-US:official&amp;#038;client=firefox-a'>Twitpocalypse</a> occurred (Twitter IDs surpassing 32 bits), I updated <a href='http://destroytwitter.com/'>DestroyTwitter</a> to use floating point IDs instead of integer IDs. I figured with Snowflake that AS3&#8217;s floating point class, Number, had me covered. I was wrong.
              </p>
              <p>
                It turns out AS3 doesn&#8217;t support 64-bit numbers. To support Snowflake, I have to update DestroyTwitter to use string IDs instead of floating point IDs. A handful of problems arise because of this. For one, I must reformat DestroyTwitter&#8217;s local SQLite database to use TEXT columns instead of REAL. Also, string comparison doesn&#8217;t exactly behave the same as number comparison. For example, &#8220;9&#8221; &gt; &#8220;1&#8221; because 9 comes after 1.
              </p>
              <p>
                To overcome this inconvenience, we need a more complex method of comparison than a simple &lt; or &gt;. We could left pad the string with zeros, but this is expensive in AS3 and impossible in SQLite. I prefer comparing the string lengths first, then the strings as numbers:
              </p>
              <pre>
<code>newID.length &gt; oldID.length || newID &gt; oldID</code>
</pre>
              <p>
                Just like AS3, SQLite lacks support for 64-bit numbers. You would think the same comparison method in SQL syntax would work:
              </p>
              <pre>
<code>length(newID) &gt; length(oldID) OR newID &gt; oldID</code>
</pre>
              <p>
                It doesn&#8217;t. AS3 and SQL differ in the way each handles conditions. In AS3, the conditions relate to each other. If the first condition is false, the second condition assumes the first condition is false. For example:
              </p>
              <pre>
<code>booleanA || booleanB</code>
</pre>
              <p>
                really means
              </p>
              <pre>
<code>booleanA || !booleanA &amp;&amp; booleanB</code>
</pre>
              <p>
                SQL, on the other hand, treats each condition separately. It acts like this if it were in AS3:
              </p>
              <pre>
<code>if (booleanA) callMethod();

if (booleanB) callMethod();</code>
</pre>
              <p>
                As a result, our SQL comparison must be a bit more explicit:
              </p>
              <pre>
<code>length(newID) &gt; length(oldID) OR length(newID) = length(oldID) AND newID &gt; oldID</code>
</pre>
              <p>
                Hopefully, AS3 and SQLite will support 64-bit floating point in the near future. Until then, we&#8217;ll have to resort to workarounds like the ones above.
              </p>
              <div class="metadata">
                <div class="tags">
                  <a href="/blog/tag/code">code</a> + <a href="/blog/tag/as3">as3</a> + <a href="/blog/tag/sqlite">sqlite</a>
                </div>
              </div>
            </div>
            <div id="disqus_thread"></div><script type="text/javascript">
//<![CDATA[
            var disqus_url = "http://staging.destroytoday.com/blog/comparing-64-bit-numbers";
            var disqus_identifier = "http://staging.destroytoday.com/blog/comparing-64-bit-numbers";
            var disqus_title = "Comparing 64-bit numbers in AS3 and SQLite";
            //]]>
            </script>
          </div>
          <div id="sidebar" class="grid-1">
            <!--<div id="search-wrapper">
                        <input id="search" type="text" />
                        <hr/>
                </div>-->
            <div id="latest-tweet">
              <a href="http://twitter.com/destroytoday"><img src="/assets/site/twitter_avatar.jpg" width="32" height="32" alt="@destroytoday" /></a>
              <p></p>
              <hr />
            </div>
            <div id="related-posts">
              <div class="thumb alpha omega c3">
                <a href="/blog/luminant_point_arrays"><img src="/assets/blog/luminant_point_arrays/luminant_point_arrays_lg_thumb.jpg" width="200" height="200" alt="Luminant Point Arrays by Stephan Tillmans" /></a>
                <div class="hidden-metadata">
                  <div class="title">
                    <a href="/blog/luminant_point_arrays">Luminant Point Arrays by Stephan Tillmans</a>
                  </div>
                </div>
                <div class="color_blocks" onclick="document.location='/blog/luminant_point_arrays'">
                  <div class="color_block c1"></div>
                  <div class="color_block c2"></div>
                </div>
                <div class="metadata">
                  <div class="title">
                    <a href="/blog/luminant_point_arrays">Luminant Point Arrays by Stephan Tillmans</a>
                  </div>
                </div>
              </div>
              <hr />
              <div class="thumb alpha omega c3">
                <a href="/blog/konami-code"><img src="/assets/blog/konami-code/konami-code-lg-thumb.png" width="200" height="200" alt="Konami Code added to DestroyFramework" /></a>
                <div class="hidden-metadata">
                  <div class="title">
                    <a href="/blog/konami-code">Konami Code added to DestroyFramework</a>
                  </div>
                </div>
                <div class="color_blocks" onclick="document.location='/blog/konami-code'">
                  <div class="color_block c4"></div>
                  <div class="color_block c5"></div>
                  <div class="color_block c6"></div>
                  <div class="color_block c7"></div>
                </div>
                <div class="metadata">
                  <div class="title">
                    <a href="/blog/konami-code">Konami Code added to DestroyFramework</a>
                  </div>
                </div>
              </div>
              <hr />
              <div class="thumb alpha omega c11">
                <a href="/blog/letterpressed-indesign-icons"><img src="/assets/blog/letterpressed-indesign-icons/letterpressed-indesign-icons-lg-thumb.jpg" width="200" height="200" alt="Letterpressed InDesign icons" /></a>
                <div class="hidden-metadata">
                  <div class="title">
                    <a href="/blog/letterpressed-indesign-icons">Letterpressed InDesign icons</a>
                  </div>
                </div>
                <div class="color_blocks" onclick="document.location='/blog/letterpressed-indesign-icons'">
                  <div class="color_block c7"></div>
                  <div class="color_block c8"></div>
                  <div class="color_block c9"></div>
                  <div class="color_block c10"></div>
                </div>
                <div class="metadata">
                  <div class="title">
                    <a href="/blog/letterpressed-indesign-icons">Letterpressed InDesign icons</a>
                  </div>
                </div>
              </div>
              <hr />
            </div><!--<div id="latest-flickr">poop</div>-->
          </div>
        </div>
        <div id="prev" class="direction">
          <a href="/blog/dayone"><span class="title_wrapper"><span class="title">Day One</span></span> <span class="arrow_wrapper"><span class="arrow">&#8249;</span></span></a>
        </div>
        <div id="next" class="direction">
          <a href="/blog/letterpressed-indesign-icons"><span class="arrow_wrapper"><span class="arrow">&#8250;</span></span> <span class="title_wrapper"><span class="title">Letterpressed InDesign icons</span></span></a>
        </div>
      </div>
      <div id="footer">
        <div id="footer_wrapper">
          <div id="copyright_wrapper">
            <div id="copyright">
              copyright &#169; Jonnie Hallman 2005-2011&#160;&#160;+
            </div>
          </div>
          <div id="twitter_follow_wrapper">
            <div id="twitter_follow">
              <a href="http://twitter.com/destroytoday" class="twitter-follow-button" data-show-count="false">Follow @destroytoday</a>
            </div>
          </div>
        </div>
      </div>
    </div><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript">
</script><script src="/js/jquery.swfobject.1.1.1.min.js" type="text/javascript">
</script><script src="/js/jquery.easing.1.3.js" type="text/javascript">
</script><script src="/js/jquery.timeago.js" type="text/javascript">
</script><script src="/js/jquery.cookie.min.js" type="text/javascript">
</script><!--<script src="/js/jquery.imgareaselect.min.js" type="text/javascript"></script>-->
    <script src="/js/destroytoday.global.min.js" type="text/javascript">
</script><!--[if lte IE 6]><script src="/js/ie6warning.js" type="text/javascript"></script><script type="text/javascript">window.onload=function(){e("/assets/site/ie6warning/")}</script><![endif]-->
    <script type="text/javascript" src="http://use.typekit.com/aeu3zes.js">
</script><script type="text/javascript">
//<![CDATA[
    try{Typekit.load();}catch(e){}
    //]]>
    </script><script type="text/javascript">
//<![CDATA[
                        $(document).keyup(function(event)
                        {
                                if (event.keyCode == '37')
                                {
                                        window.location = "/blog/dayone"
                                } 
                        });
    //]]>
    </script><script type="text/javascript">
//<![CDATA[
                        $(document).keyup(function(event)
                        {
                                if (event.keyCode == '39')
                                {
                                        window.location = "/blog/letterpressed-indesign-icons"
                                } 
                        });
    //]]>
    </script><script type="text/javascript">
//<![CDATA[
                    (function () {
                        var s = document.createElement('script'); s.async = true;
                        s.type = 'text/javascript';
                        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
                        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                    }());
    //]]>
    </script>
  </body>
</html>
