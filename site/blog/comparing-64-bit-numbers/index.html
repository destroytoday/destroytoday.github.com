<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<title>Destroy Today / Comparing 64-bit numbers in AS3 and SQLite</title>
		
		<link type="application/rss+xml" rel="alternate" title="Destroy Today" href="http://feeds.feedburner.com/destroytoday" />
		
		


  <link rel="stylesheet" href="http://f.fontdeck.com/s/css/Aa4uHlYiunplvlGC3xxxC30QQ2w/staging.destroytoday.com/8877.css" type="text/css" />



		
  <link href="/css/screen.css" rel="stylesheet" type="text/css" />

		
		<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3256994-11']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
		<script type="text/javascript">
		var disqus_shortname = 'destroytodaystaging';
		var disqus_developer = 1;
		var disqus_container_id = 'disqus_thread';
		var disqus_domain = 'disqus.com';
</script>
	</head>
	
	<body>
	  <div id="site">
  		<div id="page">
  			<div id="top">
  			  <div id="identity">
	<h1>
		<a href="/" class="destroy">destroy</a><a href="/" class="today">today</a>
	</h1>
</div>
  				<div id="navigation">
	<ul>
		
			
				<li><a href="/about">About</a></li>
			
		
			
				<li class="selected"><a href="/blog">Blog</a></li>
			
		
			
				<li><a href="/folio">Folio</a></li>
			
		
			
				<li><a href="/lab">Lab</a></li>
			
		
			
				<li><a href="/contact">Contact</a></li>
			
		
	</ul>
</div>
  			</div>
  			<div id="content">
  				<div id="blog">
	<div id="primary" class="grid-3">
		
<div class="post">
	<h2><a href="/blog/comparing-64-bit-numbers">Comparing 64-bit numbers in AS3 and SQLite</a></h2>
	<div class="metadata">
		<div class="date"><a href="/blog/comparing-64-bit-numbers">01.30.11</a></div><div class="comment-count"><a href="/blog/comparing-64-bit-numbers#disqus_thread" data-disqus-identifier="http://staging.destroytoday.com/blog/comparing-64-bit-numbers">0</a> <a href="/blog/comparing-64-bit-numbers"><img class="bubble-up" src="/assets/site/comment_up.png" width="10" height="10" /><img class="bubble-over" src="/assets/site/comment_over.png" width="10" height="10" /></a></div>
	</div>
	<p>When <a href='http://engineering.twitter.com/2010/06/announcing-snowflake.html'>Twitter introduced Snowflake</a>, their new ID generator, they also introduced 64-bit IDs. At first, I didn&#8217;t think much of this. When the <a href='http://www.google.com/search?q=twitpocalypse&amp;#038;ie=utf-8&amp;#038;oe=utf-8&amp;#038;aq=t&amp;#038;rls=org.mozilla:en-US:official&amp;#038;client=firefox-a'>Twitpocalypse</a> occurred (Twitter IDs surpassing 32 bits), I updated <a href='http://destroytwitter.com/'>DestroyTwitter</a> to use floating point IDs instead of integer IDs. I figured with Snowflake that AS3&#8217;s floating point class, Number, had me covered. I was wrong.</p>

<p>It turns out AS3 doesn&#8217;t support 64-bit numbers. To support Snowflake, I have to update DestroyTwitter to use string IDs instead of floating point IDs. A handful of problems arise because of this. For one, I must reformat DestroyTwitter&#8217;s local SQLite database to use TEXT columns instead of REAL. Also, string comparison doesn&#8217;t exactly behave the same as number comparison. For example, &#8220;9&#8221; &gt; &#8220;1&#8221; because 9 comes after 1.</p>

<p>To overcome this inconvenience, we need a more complex method of comparison than a simple &lt; or &gt;. We could left pad the string with zeros, but this is expensive in AS3 and impossible in SQLite. I prefer comparing the string lengths first, then the strings as numbers:</p>

<pre><code>newID.length &gt; oldID.length || newID &gt; oldID</code></pre>

<p>Just like AS3, SQLite lacks support for 64-bit numbers. You would think the same comparison method in SQL syntax would work:</p>

<pre><code>length(newID) &gt; length(oldID) OR newID &gt; oldID</code></pre>

<p>It doesn&#8217;t. AS3 and SQL differ in the way each handles conditions. In AS3, the conditions relate to each other. If the first condition is false, the second condition assumes the first condition is false. For example:</p>

<pre><code>booleanA || booleanB</code></pre>

<p>really means</p>

<pre><code>booleanA || !booleanA &amp;&amp; booleanB</code></pre>

<p>SQL, on the other hand, treats each condition separately. It acts like this if it were in AS3:</p>

<pre><code>if (booleanA) callMethod();

if (booleanB) callMethod();</code></pre>

<p>As a result, our SQL comparison must be a bit more explicit:</p>

<pre><code>length(newID) &gt; length(oldID) OR length(newID) = length(oldID) AND newID &gt; oldID</code></pre>

<p>Hopefully, AS3 and SQLite will support 64-bit floating point in the near future. Until then, we&#8217;ll have to resort to workarounds like the ones above.</p>
	<div class="metadata">
		<div class="tags"><a href="/blog/tag/code">code</a> + <a href="/blog/tag/as3">as3</a> + <a href="/blog/tag/sqlite">sqlite</a></div>
	</div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_url = "http://staging.destroytoday.com/blog/comparing-64-bit-numbers";
	var disqus_identifier = "http://staging.destroytoday.com/blog/comparing-64-bit-numbers";
	var disqus_title = "Comparing 64-bit numbers in AS3 and SQLite";
</script>

	</div>
	<div id="sidebar" class="grid-1">
		<!--<div id="search-wrapper">
			<select id="search" class="chzn-select" title="Search tags..." tabIndex="1">
			  <option value=""></option>
			  ["<option value=\"Code\">Code</option>"]["<option value=\"AS3\">AS3</option>"]["<option value=\"Open Source\">Open Source</option>"]["<option value=\"Adobe\">Adobe</option>"]["<option value=\"Poster\">Poster</option>"]["<option value=\"Photography\">Photography</option>"]["<option value=\"Story\">Story</option>"]["<option value=\"SQLite\">SQLite</option>"]["<option value=\"Review\">Review</option>"]["<option value=\"iOS\">iOS</option>"]["<option value=\"OSX\">OSX</option>"]["<option value=\"Artist\">Artist</option>"]["<option value=\"Product\">Product</option>"]
			</select>
			<hr/>
		</div>-->
		<div id="latest-tweet">
			<a href="http://twitter.com/destroytoday"><img src="/assets/site/twitter_avatar.jpg" width="32" height="32" alt="@destroytoday" /></a>
			<p></p>
			<hr/>
		</div>
		<div id="related-posts">
		  
		    
  			
  			  
  			    
  			      <div class="thumb alpha omega" style="background: #2A2624">
	<a href="/blog/infinity-file">
	  <img src="/assets/blog/infinity-file/infinity-file-thumb.jpg" width="200" height="200" alt="Infinity File" />
	  <div class="hidden-metadata">
  		<div class="title">Infinity File</div>
  	</div>
  	<div class="color_blocks">
  		
  			
  				<div class="color_block" style="width: 25.0%; background: #DCDBE0"></div>
  			
  				<div class="color_block" style="width: 25.0%; background: #7C7C79"></div>
  			
  				<div class="color_block" style="width: 25.0%; background: #4E5C6A"></div>
  			
  				<div class="color_block" style="width: 25.0%; background: #2A2624"></div>
  			
  		
  	</div>
  	<div class="metadata">
  		<div class="title">Infinity File</div>
  	</div>
  </a>
</div>

  			      
  			      <hr/>
  			    
  			  
  			
  			  
  			    
  			      <div class="thumb alpha omega" style="background: #000000">
	<a href="/blog/luminant-point-arrays">
	  <img src="/assets/blog/luminant-point-arrays/luminant-point-arrays-thumb.jpg" width="200" height="200" alt="Luminant Point Arrays by Stephan Tillmans" />
	  <div class="hidden-metadata">
  		<div class="title">Luminant Point Arrays by Stephan Tillmans</div>
  	</div>
  	<div class="color_blocks">
  		
  			
  				<div class="color_block" style="width: 50.0%; background: #5A919F"></div>
  			
  				<div class="color_block" style="width: 50.0%; background: #000000"></div>
  			
  		
  	</div>
  	<div class="metadata">
  		<div class="title">Luminant Point Arrays by Stephan Tillmans</div>
  	</div>
  </a>
</div>

  			      
  			      <hr/>
  			    
  			  
  			
  			  
  			    
  			      <div class="thumb alpha omega" style="background: #52C8E6">
	<a href="/blog/dayone">
	  <img src="/assets/blog/dayone/dayone-thumb.png" width="200" height="200" alt="Day One &mdash; potentially my first successful journal ever" />
	  <div class="hidden-metadata">
  		<div class="title">Day One &mdash; potentially my first successful journal ever</div>
  	</div>
  	<div class="color_blocks">
  		
  			
  				<div class="color_block" style="width: 25.0%; background: #C9412E"></div>
  			
  				<div class="color_block" style="width: 25.0%; background: #2D2D2D"></div>
  			
  				<div class="color_block" style="width: 25.0%; background: #E0E3E5"></div>
  			
  				<div class="color_block" style="width: 25.0%; background: #52C8E6"></div>
  			
  		
  	</div>
  	<div class="metadata">
  		<div class="title">Day One &mdash; potentially my first successful journal ever</div>
  	</div>
  </a>
</div>

  			      
  			      <hr/>
  			    
  			  
  			
  			  
  			
  			  
  			    
  			  
  			
  			  
  			    
  			  
  			
  			  
  			    
  			  
  			
  			  
  			
  			  
  			    
  			  
  			
  			  
  			
  		
		</div>
		<!--<div id="latest-flickr">poop</div>-->
	</div>
</div>
<script type="text/javascript">
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

  			</div>
  			<div id="footer">
	<div id="footer_wrapper">
		<div id="copyright_wrapper">
			<div id="copyright">copyright &copy; <a href="/contact">Jonnie Hallman</a> 2005-2011&nbsp;&nbsp;+</div>
		</div>
		<div id="twitter_follow_wrapper">
			<div id="twitter_follow"><a href="http://twitter.com/destroytoday" class="twitter-follow-button" data-show-count="false">Follow @destroytoday</a></div>
		</div>
	</div>
</div>
  		</div>
  		

	

	
	
	
	
	  
	
		
	
	
	
	
	
	
	

	

	
	
	
	
	  
	
		
	
	
	
	
	
	
	

	

	
	
	
	
	  
	
		
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	
		
	

	
	
	

	

	
	
	
	
	
	
	
	
	
	  
	
		
	
	
	
	

	

	
	
	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	

	

	
	
	
	
	
	
	
	
	


	
  
  


<div id="prev" class="direction">
	<a href="/blog/dayone"><span class="title_wrapper"><span class="title">Day One</span></span> <span class="arrow_wrapper"><span class="arrow">&lsaquo;</span></span></a>
</div>
<script type="text/javascript">
	$(document).keyup(function(event)
	{
		if (event.keyCode == '37')
		{
			window.location = "/blog/dayone"
		} 
	});
</script>


<div id="next" class="direction">
	<a href="/blog/todays-cuts"><span class="arrow_wrapper"><span class="arrow">&rsaquo;</span></span> <span class="title_wrapper"><span class="title">Today's Cuts</span></span></a>
</div>
<script type="text/javascript">
	$(document).keyup(function(event)
	{
		if (event.keyCode == '39')
		{
			window.location = "/blog/todays-cuts"
		} 
	});
</script>

  	</div>
		
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script>


<script src="/js/jquery.timeago.js" type="text/javascript"></script>

<script src="/js/jquery.cookie.min.js" type="text/javascript"></script>




<script src="/js/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/js/destroytoday.global.min.js" type="text/javascript"></script>
<!--[if lte IE 6]><script src="/js/ie6warning.js" type="text/javascript"></script><script type="text/javascript">window.onload=function(){e("/assets/site/ie6warning/")}</script><![endif]-->
	</body>
</html>
